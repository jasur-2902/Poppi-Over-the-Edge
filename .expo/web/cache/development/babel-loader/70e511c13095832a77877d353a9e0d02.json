{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport RemoteLogging from \"./RemoteLogging\";\n\nfunction createRemoteConsole(originalConsole) {\n  var groupDepth = 0;\n  var enhancedConsole = Object.create(originalConsole);\n\n  _defineConsoleLogMethod('debug', 'info');\n\n  _defineConsoleLogMethod('log', 'info');\n\n  _defineConsoleLogMethod('info', 'info');\n\n  _defineConsoleLogMethod('warn', 'warn');\n\n  _defineConsoleLogMethod('error', 'error');\n\n  enhancedConsole.assert = function assert(condition) {\n    for (var _len = arguments.length, data = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      data[_key - 1] = arguments[_key];\n    }\n\n    if (originalConsole.assert) {\n      originalConsole.assert(!!condition, ...data);\n    }\n\n    if (condition) {\n      return;\n    }\n\n    var assertionMessage = 'Assertion failed';\n\n    if (!data.length) {\n      data.push(assertionMessage);\n    } else {\n      if (typeof data[0] !== 'string') {\n        data.unshift(assertionMessage);\n      } else {\n        data[0] = \"\".concat(assertionMessage, \": \").concat(data[0]);\n      }\n    }\n\n    _enqueueRemoteLog('error', {}, data);\n  };\n\n  enhancedConsole.group = function group() {\n    for (var _len2 = arguments.length, data = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      data[_key2] = arguments[_key2];\n    }\n\n    if (originalConsole.group) {\n      originalConsole.group(...data);\n    }\n\n    _enqueueRemoteLog('info', {}, data);\n\n    groupDepth++;\n  };\n\n  enhancedConsole.groupCollapsed = function groupCollapsed() {\n    for (var _len3 = arguments.length, data = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      data[_key3] = arguments[_key3];\n    }\n\n    if (originalConsole.groupCollapsed) {\n      originalConsole.groupCollapsed(...data);\n    }\n\n    _enqueueRemoteLog('info', {\n      groupCollapsed: true\n    }, data);\n\n    groupDepth++;\n  };\n\n  enhancedConsole.groupEnd = function groupEnd() {\n    if (originalConsole.groupEnd) {\n      originalConsole.groupEnd();\n    }\n\n    if (groupDepth > 0) {\n      groupDepth--;\n    }\n\n    _enqueueRemoteLog('info', {\n      shouldHide: true\n    }, []);\n  };\n\n  function _defineConsoleLogMethod(name, level) {\n    enhancedConsole[name] = function __expoConsoleLog() {\n      var originalMethod = originalConsole[name];\n\n      for (var _len4 = arguments.length, data = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        data[_key4] = arguments[_key4];\n      }\n\n      if (typeof originalMethod === 'function') {\n        originalMethod.apply(originalConsole, data);\n      }\n\n      _enqueueRemoteLog(level, {}, data);\n    };\n  }\n\n  function _enqueueRemoteLog(level, additionalFields, data) {\n    RemoteLogging.enqueueRemoteLogAsync(level, _objectSpread({\n      groupDepth\n    }, additionalFields), data).catch(error => {\n      originalConsole.error(\"There was a problem sending log messages to your development environment\", error);\n    });\n  }\n\n  return enhancedConsole;\n}\n\nexport default {\n  createRemoteConsole\n};","map":{"version":3,"sources":["../../src/logs/RemoteConsole.ts"],"names":[],"mappings":"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","sourcesContent":["import RemoteLogging, { LogEntryFields, LogLevel } from './RemoteLogging';\n\n/**\n * Creates a console object that delegates calls to the specified underlying console and also sends\n * the messages to the development environment over a remote connection.\n */\nfunction createRemoteConsole(originalConsole: Console): Console {\n  let groupDepth = 0;\n\n  const enhancedConsole: typeof originalConsole = Object.create(originalConsole);\n\n  // https://console.spec.whatwg.org/#debug\n  // Don't use a level below \"info\" because \"debug\" is intended for messages that shouldn't be shown\n  // to the developer\n  _defineConsoleLogMethod('debug', 'info');\n\n  // https://console.spec.whatwg.org/#log\n  _defineConsoleLogMethod('log', 'info');\n\n  // https://console.spec.whatwg.org/#info\n  _defineConsoleLogMethod('info', 'info');\n\n  // https://console.spec.whatwg.org/#warn\n  _defineConsoleLogMethod('warn', 'warn');\n\n  // https://console.spec.whatwg.org/#error\n  _defineConsoleLogMethod('error', 'error');\n\n  // https://console.spec.whatwg.org/#assert\n  enhancedConsole.assert = function assert(condition: unknown, ...data: unknown[]): void {\n    if (originalConsole.assert) {\n      // @ts-ignore\n      originalConsole.assert(!!condition, ...data);\n    }\n\n    if (condition) {\n      return;\n    }\n\n    const assertionMessage = 'Assertion failed';\n    if (!data.length) {\n      data.push(assertionMessage);\n    } else {\n      if (typeof data[0] !== 'string') {\n        data.unshift(assertionMessage);\n      } else {\n        data[0] = `${assertionMessage}: ${data[0]}`;\n      }\n    }\n\n    _enqueueRemoteLog('error', {}, data);\n  };\n\n  // https://console.spec.whatwg.org/#group\n  enhancedConsole.group = function group(...data: unknown[]): void {\n    if (originalConsole.group) {\n      // @ts-ignore\n      originalConsole.group(...data);\n    }\n\n    _enqueueRemoteLog('info', {}, data);\n    groupDepth++;\n  };\n\n  // https://console.spec.whatwg.org/#groupcollapsed\n  enhancedConsole.groupCollapsed = function groupCollapsed(...data: unknown[]): void {\n    if (originalConsole.groupCollapsed) {\n      // @ts-ignore\n      originalConsole.groupCollapsed(...data);\n    }\n\n    _enqueueRemoteLog('info', { groupCollapsed: true }, data);\n    groupDepth++;\n  };\n\n  // https://console.spec.whatwg.org/#groupend\n  enhancedConsole.groupEnd = function groupEnd(): void {\n    if (originalConsole.groupEnd) {\n      originalConsole.groupEnd();\n    }\n\n    if (groupDepth > 0) {\n      groupDepth--;\n    }\n\n    _enqueueRemoteLog('info', { shouldHide: true }, []);\n  };\n\n  /**\n   * Defines a method in the `console.log()` family on the enhanced console\n   * instance\n   */\n  function _defineConsoleLogMethod(name: keyof typeof console, level: LogLevel): void {\n    enhancedConsole[name] = function __expoConsoleLog(...data: unknown[]): void {\n      let originalMethod = originalConsole[name];\n      if (typeof originalMethod === 'function') {\n        originalMethod.apply(originalConsole, data);\n      }\n\n      _enqueueRemoteLog(level, {}, data);\n    };\n  }\n\n  /**\n   * Schedules the given log entry to be sent remotely in a safe way that handles all errors. This\n   * function is responsible for error handling because the console methods are synchronous but\n   * sending log messages is asynchronous, so this code (instead of the console methods) needs to be\n   * responsible for asynchronous errors.\n   */\n  function _enqueueRemoteLog(\n    level: LogLevel,\n    additionalFields: LogEntryFields,\n    data: unknown[]\n  ): void {\n    RemoteLogging.enqueueRemoteLogAsync(level, { groupDepth, ...additionalFields }, data).catch(\n      error => {\n        originalConsole.error(\n          `There was a problem sending log messages to your development environment`,\n          error\n        );\n      }\n    );\n  }\n\n  return enhancedConsole;\n}\n\nexport default {\n  createRemoteConsole,\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}